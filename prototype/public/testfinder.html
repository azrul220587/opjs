<!doctype html>
<html>
<head><title>Test Finder</title></head>
<body>
<script src="scripts/lib/require.js"></script>
<script>
require.config({
  baseUrl: 'scripts',
  paths: {
    q: 'lib/q',
    transport: 'modules/transport'
  },
  shim: {
    transport: {
      deps: ['q'],
    }
  }
});
require(['transport'], function (Transport) {
  var url = window.location.toString().replace(/^http/, 'ws');
  var transport = new Transport({
    'invite': function (request, transport) {
      return {
        peer: true,
        blob: (Math.random() * 0x100000000).toString(32)
      };
    }
  });

  transport.open(new WebSocket(url))
  .then(function () {
    return transport.sessionCreate('creationix');
  })
  .then(function (result) {
    var blob = (Math.random() * 0x100000000).toString(32);
    return transport.peerLocationFind('creationix', blob);
  })
  .then(function (reply) {
    console.log("find-reply!", reply);
  });
});
</script>
</body>
</html>
